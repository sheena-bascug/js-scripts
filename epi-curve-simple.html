<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="author" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>

    <canvas id="wordwide" width="400" height="400"></canvas>




<script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>

<script type="text/javascript">  

    var outData = [];
    var worldwideSettings = {
        "async": false,
        "url": "https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services/Historic_adm0_v3/FeatureServer/0/query",
        "method": "POST",
        "timeout": 0,
        "headers": {
        "Content-Type": "application/x-www-form-urlencoded"
        },
        "data": {
        "f": "json",
        "where": "1=1",
        "returnGeometry": "false",
        "spatialRel": "esriSpatialRelIntersects",
        "orderByFields": "DateOfDataEntry asc",
        "groupByFieldsForStatistics": "DateOfDataEntry",
        "outStatistics": "[{\"statisticType\": \"Sum\", \"onStatisticField\": \"NewCase\", \"outStatisticFieldName\": \"DailyNewCases\"}]",
        "resultOffset": "0",
        "cacheHint": "true"
        },
        success: function(response) {
            var result = JSON.parse(response);
            var entries = [];
            
            result.features.forEach(function (entry) {
                var entryDate = new Date(entry.attributes.DateOfDataEntry).toLocaleDateString('en-CA');
                var entryNewCaseTotal = entry.attributes.DailyNewCases;
                
                entries.push({ "DateOfDataEntry" : entryDate, "DailyNewCaseTotal": entryNewCaseTotal});
            });

            
            outData = entries.slice();
            // outData.Labels = DateLabels;
            // outData.Cases = CaseData;


            // return { Labels : DateLabels, NewCases : CaseData };
        }
    };

    $.ajax(worldwideSettings);

    $(document).ready( function() {
        var DateLabels = outData.map( function (entry) { return entry.DateOfDataEntry; });
        var CaseData = outData.map( function (entry) { return entry.DailyNewCaseTotal; });

        
        var ctx = document.getElementById('wordwide').getContext('2d');
            
            var myChart  = new Chart (ctx, {
                type: 'bar',
                data: {
                    labels: DateLabels,
                    datasets: [{
                        data: CaseData,
                        // backgroundColor: fillPattern
                    }]
                }
            });
    });

    console.log("-----------------------");

    console.log(outData);

</script>


</body>

</html>