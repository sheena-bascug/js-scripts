<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title></title>
    <meta name="author" content="">
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

</head>

<body>

    <canvas id="wordwide" width="400" height="300"></canvas>
    <canvas id="canada" width="400" height="300"></canvas>

<script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.3/Chart.min.js"></script>

<script type="text/javascript">  

    var worldData = [];
    var canadaData = [];

    var worldSettings = {
        "async": false,
        "url": "https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services/Historic_adm0_v3/FeatureServer/0/query",
        "method": "POST",
        "timeout": 0,
        "headers": {
        "Content-Type": "application/x-www-form-urlencoded"
        },
        "data": {
        "f": "json",
        "where": "1=1",
        "returnGeometry": "false",
        "spatialRel": "esriSpatialRelIntersects",
        "orderByFields": "DateOfDataEntry asc",
        "groupByFieldsForStatistics": "DateOfDataEntry",
        "outStatistics": "[{\"statisticType\": \"Sum\", \"onStatisticField\": \"NewCase\", \"outStatisticFieldName\": \"DailyNewCases\"}]",
        "resultOffset": "0",
        "cacheHint": "true"
        },
        success: function(response) {
            var result = JSON.parse(response);
            var entries = result.features.map(function (entry) {
                return {
                    "DateOfDataEntry" : new Date(entry.attributes.DateOfDataEntry).toLocaleDateString('en-CA'),
                    "DailyNewCase": entry.attributes.DailyNewCases                    
                };
            });
            
            worldData = entries.slice();
        }
    };

    var canadaSettings = {
        "async": false,
        "url": "https://services.arcgis.com/5T5nSi527N4F7luB/ArcGIS/rest/services/Historic_adm0_v3/FeatureServer/0/query",
        "method": "POST",
        "timeout": 0,
        "headers": {
            "Content-Type": "application/x-www-form-urlencoded"
        },
        "data": {
            "f": "json",
            "where": "ADM0_VIZ_NAME = 'CANADA'",
            "outFields": "OBJECTID, DateOfDataEntry, cum_conf, NewCase, ADM0_VIZ_NAME",
            "returnGeometry": "false",
            "spatialRel": "esriSpatialRelIntersects",
            "orderByFields": "DateOfDataEntry asc",
            "resultOffset": "0",
            "cacheHint": "true"
        }, success: function(response) {
            var result = JSON.parse(response);
            var entries = result.features.map(function (entry) { 
                return {
                    "DateOfDataEntry" : new Date(entry.attributes.DateOfDataEntry).toLocaleDateString('en-CA'),
                    "DailyNewCase": entry.attributes.NewCase
                }; 
            })
          
            canadaData = entries.slice();

        }
    };

    $(document).ready( function() {
        $.ajax(worldSettings);
        $.ajax(canadaSettings);

        var canadaOffsetDates = ["2020-01-21", "2020-01-22", "2020-01-23", "2020-01-24", "2020-01-25"];
        var canadaOffsetCases = [0, 0, 0, 0, 0];

        var worldDateLabel = worldData.map( function (entry) { return entry.DateOfDataEntry; });
        var worldCaseData = worldData.map( function (entry) { return entry.DailyNewCase; });
        var canadaDateLabels = canadaOffsetDates.concat(canadaData.map( function (entry) { return entry.DateOfDataEntry; }));
        var canadaCaseDate = canadaOffsetCases.concat(canadaData.map( function(entry) { return entry.DailyNewCase; }));
        
        var globalChart = document.getElementById('wordwide').getContext('2d');
        var canadaChart = document.getElementById('canada').getContext('2d');    
        
        var myChart  = new Chart (globalChart, {
            type: 'bar',
            data: {
                labels: worldDateLabel,
                datasets: [
                    {
                        label: "Global Daily New Cases",
                        data: worldCaseData,
                        backgroundColor: "#ff9f1c"
                    }, 
                ]
            }
        });
           
        var myChart  = new Chart (canadaChart, {
            type: 'bar',
            data: {
                labels: canadaDateLabels,
                datasets: [
                    {
                        label: "Canada Daily New Cases",
                        data: canadaCaseDate,
                        backgroundColor: "#ff0000"
                    },
                ]
            }
        });
    });


</script>


</body>

</html>